<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="model_ott_category_subscription" model="ir.module.category">
            <field name="name">OTT Subscription</field>
            <field name="description">Permisos para el modulo de Suscripciones OTT</field>
            <field name="sequence">20</field>
        </record>

        <record id="group_ott_user" model="res.groups">
            <field name="name">OTT User</field>
            <field name="category_id" ref="model_ott_category_subscription"/>
            <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
        </record>

        <record id="group_ott_gift" model="res.groups">
            <field name="name">OTT GiftCards</field>
            <field name="category_id" ref="model_ott_category_subscription"/>
        </record>

        <record id="group_ott_admin" model="res.groups">
            <field name="name">OTT Admin</field>
            <field name="category_id" ref="model_ott_category_subscription"/>
            <field name="implied_ids" eval="[(4, ref('group_ott_user'))]"/>
            <field name="users" eval="[(4, ref('base.user_root')), (4, ref('base.user_admin'))]"/>
        </record>
        
        <record id="rule_ott_franchise_visibility" model="ir.rule">
            <field name="name">OTT Franchise: Ver solo permitidas</field>
            <field name="model_id" ref="model_ott_franchise"/>
            <field name="groups" eval="[(4, ref('group_ott_user'))]"/>
            <field name="domain_force">
                [
                    '|', '|',
                    (user.has_group('ott_subscription.group_ott_admin'), '=', True),
                    (user.has_group('base.group_system'), '=', True),
                    ('id', 'in', user.allowed_franchises.ids)
                ]
            </field>
        </record>

        <record id="rule_ott_subscription_package_franchise" model="ir.rule">
            <field name="name">OTT Subscription: Filtro por Franquicia de Registro</field>
            <field name="model_id" ref="model_subscription_package"/>
            <field name="groups" eval="[(4, ref('group_ott_user'))]"/>
            <field name="domain_force">
                [
                    '|', '|',
                    (user.has_group('ott_subscription.group_ott_admin'), '=', True),
                    (user.has_group('base.group_system'), '=', True),
                    '|',
                        ('franchise_id', 'in', user.allowed_franchises.ids),
                        ('franchise_id', '=', False)
                ]
            </field>
        </record>

        <record id="rule_ott_giftcard_franchise_visibility" model="ir.rule">
            <field name="name">OTT Giftcard: Ver solo de mis franquicias</field>
            <field name="model_id" ref="model_gift_card"/> <field name="groups" eval="[(4, ref('group_ott_user'))]"/>
            <field name="domain_force">
                [
                    '|', '|',
                    (user.has_group('ott_subscription.group_ott_admin'), '=', True),
                    (user.has_group('base.group_system'), '=', True),
                    '|',
                        ('franchise_id', 'in', user.allowed_franchises.ids),
                        ('franchise_id', '=', False)
                ]
            </field>
        </record>

        <record id="rule_ott_template_franchise_visibility" model="ir.rule">
            <field name="name">OTT Template: Ver solo de mis franquicias</field>
            <field name="model_id" ref="model_gift_template"/> <field name="groups" eval="[(4, ref('group_ott_user'))]"/>
            <field name="domain_force">
                [
                    '|', '|',
                    (user.has_group('ott_subscription.group_ott_admin'), '=', True),
                    (user.has_group('base.group_system'), '=', True),
                    '|',
                        ('franchise_ids', 'in', user.allowed_franchises.ids),
                        ('franchise_ids', '=', False)
                ]
            </field>
        </record>

        <record id="rule_ott_order_giftcard_franchise_visibility" model="ir.rule">
            <field name="name">OTT Orden Giftcard: Ver solo de mis franquicias</field>
            <field name="model_id" ref="model_sale_order"/> <field name="groups" eval="[(4, ref('group_ott_user'))]"/>
            <field name="domain_force">
                [
                    '|', '|',
                    (user.has_group('ott_subscription.group_ott_admin'), '=', True),
                    (user.has_group('base.group_system'), '=', True),
                    '|',
                        ('franchise_id', 'in', user.allowed_franchises.ids),
                        ('franchise_id', '=', False)
                ]
            </field>
        </record>

        <record id="rule_ott_rate_template_franchise_visibility" model="ir.rule">
            <field name="name">OTT Tarifas: Ver solo las de mis franquicias</field>
            <field name="model_id" ref="model_ott_rate_template"/>
            <field name="groups" eval="[(4, ref('group_ott_user'))]"/>
            <field name="domain_force">
                [
                    '|', '|',
                        (user.has_group('ott_subscription.group_ott_admin'), '=', True),
                        (user.has_group('base.group_system'), '=', True),
                        ('rate_product', 'in', user.allowed_franchises.mapped('allowed_rate_ids.rate_product').ids)
                ]
            </field>
        </record>

        <record id="rule_product_product_franchise_visibility" model="ir.rule">
            <field name="name">OTT Productos: Ver solo los de mis franquicias</field>
            <field name="model_id" ref="product.model_product_template"/>
            <field name="groups" eval="[(4, ref('group_ott_user'))]"/>
            <field name="domain_force">
                [
                    '|', '|',
                        (user.has_group('ott_subscription.group_ott_admin'), '=', True),
                        (user.has_group('base.group_system'), '=', True),
                        '|', '|',
                            ('id', 'in', user.allowed_franchises.mapped('allowed_base_product_ids').ids),
                            ('id', 'in', user.allowed_franchises.mapped('allowed_extra_product_ids').ids),
                            ('id', 'in', user.allowed_franchises.mapped('allowed_rate_ids.rate_product').ids)
                ]
            </field>
        </record>
    </data>
</odoo>